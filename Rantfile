#!/usr/bin/env ruby

# Rantfile for Rant :)

require 'rant'
require 'rant/testtask'

task :default => :test

lib_files = FileList["lib/**/*.rb"]
doc_files = lib_files + FileList["**/*.rdoc"]
rdoc_opts = %w(-S -c UTF-8 --title Rant --main lib/rant.rb)

desc "Generate documentation."
file "doc" => doc_files do
    touch "doc" if test(?d, "doc")
    sh "rdoc #{rdoc_opts.arglist} #{doc_files.arglist}"
end

desc "Run basic tests."
gen TestTask do |t|
    t.pattern = 'test_*.rb'
end

desc "Run first test-project.",
     "Warning: writes to disc."
gen TestTask, :testp1 do |t|
    t.test_files = ["tests/project1/test_project.rb"]
end

desc "Run second test project.",
     "Warning: writes to disc"
gen TestTask, :testp2 do |t|
    t.test_files = ["tests/project2/test_project.rb"]
end

desc "Test plugins."
gen TestTask, :testplugins do |t|
    t.test_files = FileList["tests/plugin/**/test_*"]
end

desc "Run all tests."
task :testall => %w(test testp1 testp2 testplugins)

desc "Remove autogenerated files."
task :clean do
    rm_rf %w(doc pkg)
end

if $0 == __FILE__
    Rant.run
end
